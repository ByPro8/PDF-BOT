<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Suck My PDF</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f1f3f6;
    }

    /* ---------- LAYOUT ---------- */

    .app {
      display: grid;
      grid-template-columns: 260px 1fr;
      height: 100vh;
    }

    /* ---------- SIDEBAR ---------- */

    .sidebar {
      background: #1f2933;
      color: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sidebar input,
    .sidebar select,
    .sidebar button {
      width: 100%;
      padding: 6px;
      font-size: 14px;
    }

    .sidebar input,
    .sidebar select {
      border-radius: 4px;
      border: none;
    }

    .sidebar button {
      background: #3b82f6;
      border: none;
      border-radius: 4px;
      color: white;
      cursor: pointer;
    }

    .sidebar button:hover {
      background: #2563eb;
    }

    .sidebar button.red {
      background: #dc2626;
    }

    .sidebar button.red:hover {
      background: #b91c1c;
    }

    .sidebar button.gray {
      background: #6b7280;
    }

    .sidebar button.gray:hover {
      background: #4b5563;
    }

    /* ---------- MAIN ---------- */

    .main {
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    /* ---------- TOP BAR ---------- */

    .topbar {
      background: white;
      border-radius: 6px;
      padding: 8px;
      display: flex;
      gap: 6px;
      align-items: stretch;
      overflow-x: auto;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
    }

    .topbar input,
    .topbar select {
      padding: 6px;
      font-size: 14px;
    }

    .topbar button {
      padding: 6px 12px;
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .topbar button:hover {
      background: #1d4ed8;
    }

    /* ---------- TERMINAL ---------- */

    .terminal {
      flex: 1;
      background: #0f172a;
      color: #00ff9c;
      padding: 12px;
      border-radius: 6px;
      font-family: Consolas, monospace;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.6);
    }

    #out {
      flex: 1;
      overflow-y: auto;
      white-space: pre-wrap;
    }

    /* ---------- BUTTON ---------- */

    .open-btn {
      display: inline-block;
      padding: 4px 10px;
      background: #22c55e;
      color: white;
      border-radius: 4px;
      text-decoration: none;
      font-size: 12px;
      margin-top: 6px;
    }

    .open-btn:hover {
      background: #16a34a;
    }

    /* ----- TOPBAR BLOCKS ----- */

    .block {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 8px 12px;
      border-right: 1px solid #e5e7eb;
      min-width: 220px;
    }

    .block:last-child {
      border-right: none;
    }

    .title {
      font-size: 12px;
      color: #6b7280;
      font-weight: bold;
      margin-bottom: 4px;
    }
  </style>
</head>

<body>

  <div class="app">

    <!-- ================= SIDEBAR ================= -->

    <div class="sidebar">

      <input id="adminPass" type="password" placeholder="Password">

      <input id="fileId" placeholder="File ID">

      <select id="newLabel">
        <option value="real">Real</option>
        <option value="fake">Fake</option>
      </select>

      <button onclick="updateLabel()">Change Label</button>

      <button class="red" onclick="deleteFile()">Delete File</button>

      <button onclick="loadAdminLogs()">Show Logs</button>

      <button onclick="showAdminLinks()">Admin Links</button>

    </div>


    <!-- ================= MAIN ================= -->

    <div class="main">

      <!-- ---------- TOP BAR ---------- -->

      <div class="topbar">

        <!-- CHECK -->
        <div class="block">

          <div class="title">üîç Check PDF</div>

          <input id="checkFile" type="file" accept="application/pdf">

          <button onclick="checkPdf()">Check PDF</button>

        </div>


        <!-- ADD -->
        <div class="block">

          <div class="title">‚ûï Add PDFs</div>

          <input id="addFile" type="file" accept="application/pdf" multiple>

          <select id="label">
            <option value="real">Real</option>
            <option value="fake">Fake</option>
          </select>

          <button onclick="addPdf()">Add PDFs to DB</button>

        </div>


        <!-- DATABASE -->
        <div class="block">

          <div class="title">üìÇ Database</div>

          <button onclick="loadDB()">Show Database</button>

          <select id="searchType">
            <option value="name">By Name</option>
            <option value="id">By ID</option>
          </select>

          <input id="searchBox" placeholder="Search...">

          <button onclick="searchDB()">Search in Database</button>

          <button onclick="downloadDB()">Download Database</button>

        </div>

      </div>


      <!-- ---------- TERMINAL ---------- -->

      <div class="terminal">

        <div style="display:flex;justify-content:space-between;margin-bottom:6px">

          <strong>TERMINAL</strong>

          <button onclick="clearLog()"
            style="background:#374151;color:white;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;font-size:12px">
            Clear
          </button>

        </div>

        <div id="out">Ready.</div>

      </div>

    </div>

  </div>


  <!-- ================= SCRIPT ================= -->

  <script>

    const outEl = document.getElementById("out");

    const show = (t) => outEl.textContent = t;

    function clearLog() {
      show("Cleared.");
    }


    // ================= CHECK =================

    async function checkPdf() {

      const f = document.getElementById("checkFile").files[0];

      if (!f) return show("‚ùå Pick PDF");

      show("‚è≥ Checking...");

      const fd = new FormData();
      fd.append("file", f);

      try {

        const r = await fetch("/check", { method: "POST", body: fd });
        const j = await r.json();

        if (j.matched_with) {

          const link = location.origin + j.matched_with.url;

          outEl.innerHTML =
            j.message + "<br><br>" +
            `#${j.matched_with.id} | ${j.matched_with.filename}<br>` +
            `<a class="open-btn" target="_blank" href="${link}">Open PDF</a>`;

          return;
        }

        show(j.message);

      } catch {

        show("‚ùå Server error");

      }
    }


    // ================= ADD MULTI =================

    async function addPdf() {

      const input = document.getElementById("addFile");
      const label = document.getElementById("label").value;

      const files = input.files;

      if (!files.length) return show("‚ùå Pick PDFs");

      show(`‚è≥ Uploading ${files.length} files...`);

      for (let i = 0; i < files.length; i++) {

        const fd = new FormData();
        fd.append("label", label);
        fd.append("file", files[i]);

        try {

          const r = await fetch("/add", { method: "POST", body: fd });
          const j = await r.json();

          show(`‚úî ${files[i].name}: ${j.message || j.error}`);

        } catch {

          show(`‚ùå ${files[i].name}: failed`);

        }
      }

      input.value = "";
    }


    // ================= DATABASE =================

    async function loadDB() {

      show("‚è≥ Loading DB...");

      try {

        const r = await fetch("/files");
        const list = await r.json();

        if (!list.length) return show("Empty DB");

        let html = "<b>DATABASE</b><br><br>";

        list.forEach(f => {

          const link = location.origin + "/open/" + f.id;

          html += `#${f.id} | ${f.label.toUpperCase()} | ${f.filename}<br>`;
          html += `<a class="open-btn" target="_blank" href="${link}">Open</a><br><br>`;

        });

        outEl.innerHTML = html;

      } catch {

        show("‚ùå Failed");

      }
    }


    // ================= SEARCH =================

    async function searchDB() {

      const q = document.getElementById("searchBox").value.trim();
      const type = document.getElementById("searchType").value;

      if (!q) return show("‚ùå Enter text");

      show("‚è≥ Searching...");

      try {

        // Search by ID
        if (type === "id") {

          if (isNaN(q)) return show("‚ùå ID must be number");

          const r = await fetch("/files");
          const list = await r.json();

          const f = list.find(x => x.id == q);

          if (!f) return show("‚ùå Not found");

          const link = location.origin + "/open/" + f.id;

          outEl.innerHTML =
            `<b>RESULT</b><br><br>
             #${f.id} | ${f.label.toUpperCase()} | ${f.filename}<br>
             <a class="open-btn" target="_blank" href="${link}">Open</a>`;

          return;
        }


        // Search by name
        const r = await fetch("/search?q=" + encodeURIComponent(q));
        const list = await r.json();

        if (!list.length) return show("No results");

        let html = "<b>RESULTS</b><br><br>";

        list.forEach(f => {

          const link = location.origin + "/open/" + f.id;

          html += `#${f.id} | ${f.label.toUpperCase()} | ${f.filename}<br>`;
          html += `<a class="open-btn" target="_blank" href="${link}">Open</a><br><br>`;

        });

        outEl.innerHTML = html;

      } catch {

        show("‚ùå Failed");

      }
    }


    // ================= LABEL =================

    async function updateLabel() {

      const id = fileId.value.trim();
      const pw = adminPass.value.trim();
      const label = newLabel.value;

      if (!id || isNaN(id)) return show("‚ùå Invalid ID");
      if (!pw) return show("‚ùå Password");

      show("‚è≥ Updating...");

      const fd = new FormData();
      fd.append("file_id", id);
      fd.append("label", label);
      fd.append("password", pw);

      try {

        const r = await fetch("/admin/label", { method: "POST", body: fd });
        const j = await r.json();

        show(j.message || j.error);

      } catch {

        show("‚ùå Error");

      }

      adminPass.value = "";
    }


    // ================= DELETE =================

    async function deleteFile() {

      const id = fileId.value.trim();
      const pw = adminPass.value.trim();

      if (!id || isNaN(id)) return show("‚ùå Invalid ID");
      if (!pw) return show("‚ùå Password");

      if (!confirm("Delete file?")) return;

      show("‚è≥ Deleting...");

      const fd = new FormData();
      fd.append("file_id", id);
      fd.append("password", pw);

      try {

        const r = await fetch("/admin/delete", { method: "POST", body: fd });
        const j = await r.json();

        show(j.message || j.error);

      } catch {

        show("‚ùå Error");

      }

      adminPass.value = "";
    }


    // ================= ADMIN =================

    function showAdminLinks() {

      show(
        "ADMIN LINKS\n\n" +
        location.origin + "/admin/reset_db\n" +
        location.origin + "/admin/logs"
      );
    }


    async function loadAdminLogs() {

      show("‚è≥ Loading logs...");

      try {

        const r = await fetch("/admin/logs");
        const list = await r.json();

        if (!list.length) return show("No logs");

        let out = "LOGS\n\n";

        list.forEach(l => {

          out += `[${l.created_at}] ${l.action}`;

          if (l.details) out += " (" + l.details + ")";

          out += "\n";

        });

        show(out);

      } catch {

        show("‚ùå Failed");

      }
    }


    // ================= DOWNLOAD =================

    function downloadDB() {

      window.open("/admin/export", "_blank");

    }

  </script>

</body>

</html>